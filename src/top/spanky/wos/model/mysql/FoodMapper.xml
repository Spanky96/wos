<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="top.spanky.wos.model.Food">

    <resultMap type="Food" id="foodMap">
        <id column="id" property="id"/>
        <id column="type_id" property="foodType"/>
        <result column="name" property="name"/>
        <result column="info" property="info"/>
        <result column="description" property="description"/>
        <result column="price" property="price"/>
        <result column="old_price" property="oldPrice"/>
        <result column="sell_count" property="sellCount"/>
        <result column="left_count" property="leftCount"/>
        <result column="icon" property="icon"/>
        <result column="image" property="image"/>

        <collection property="foodRatings" ofType="top.spanky.wos.model.FoodRating" column="id" select="getFoodRatingByFoodId">

         </collection>
    </resultMap>
    
    <resultMap type="FoodRating" id="foodRatingMap">
         <id column="id" property="id"/>
         <result column="food_id" property="foodId"/>
         <result column="user_id" property="userId"/>
         <result column="text" property="text"/>
         <result column="time" property="time"/>
         <result column="type" property="type"/>
    </resultMap>

    <select id="getById" parameterType="int" resultMap="foodMap">
<!--         <![CDATA[
            SELECT t1.*,t2.* FROM foods t1,food_ratings t2 WHERE t1.id = #{id} and t2.food_id = #{id};
        ]]> -->
        SELECT * FROM foods where id = #{id};
    </select>
    
    <select id="getAll" resultMap="foodMap">
        <![CDATA[
            SELECT * FROM foods;
        ]]>
    </select>
    
    <select id="getFoodRatingByFoodId" resultMap="foodRatingMap">
        <![CDATA[
            SELECT * FROM food_ratings where food_id = #{id};
        ]]>
    </select>

</mapper>
